generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

////////////////////
// PRODUCT
////////////////////

model Product {
  id        String   @id @default(cuid())
  title     String
  price     Int      // cents
  inventory Int      @default(0)
  isActive  Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items     OrderItem[]
}

////////////////////
// ORDER
////////////////////

model Order {
  id        String      @id @default(cuid())
  status    OrderStatus @default(PENDING)
  amount    Int         // total cents
  email     String?

  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  items     OrderItem[]
}

enum OrderStatus {
  PENDING
  COMPLETED
  FAILED
}

////////////////////
// ORDER ITEM
////////////////////

model OrderItem {
  id        String   @id @default(cuid())
  orderId  String
  productId String

  quantity  Int      @default(1)
  unitPrice Int      // snapshot price in cents

  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
}


model NewsletterSubscriber {
  id                 String   @id @default(uuid())
  email              String   @unique
  status             String   @default("PENDING")
  confirmationToken  String?  @unique
  tokenExpiresAt     DateTime?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}
